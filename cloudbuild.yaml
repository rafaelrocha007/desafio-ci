steps:
  - id: "Rodando os testes"
    name: "gcr.io/cloud-builders/go"
    env:
      - GOPATH=/go
      - PROJECT_ROOT=/app
    args:
      - "test"
      - "/app/."

  - id: "Compilando a função soma"
    name: "gcr.io/cloud-builders/go"
    env:
      - GOPATH=/go
      - PROJECT_ROOT=/app
    args:
      - "build"
      - "-o"
      - "main"
      - "/app/."

  - id: "Executando a função soma"
    name: "gcr.io/cloud-builders/go"
    env:
      - GOPATH=/go
      - PROJECT_ROOT=/app
    args:
      - "/app/main"

  - name: "gcr.io/cloud-builders/docker"
    args:
      - "build"
      - "-t"
      - "gcr.io/$PROJECT_ID/desafio-ci:latest"
      - "."

images:
  - "gcr.io/$PROJECT_ID/desafio-ci:latest"
